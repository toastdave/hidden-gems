---
import { Alert, AlertDescription, AlertTitle } from "../components/ui/alert";
import { Badge } from "../components/ui/badge";
import { Button } from "../components/ui/button";
import { Card, CardContent, CardHeader, CardTitle } from "../components/ui/card";
import Layout from "../layouts/Layout.astro";
import { apiServerBase, fetchApiJson } from "../lib/api";

const apiBase = apiServerBase;
const result = await fetchApiJson<{ favorites: Array<Record<string, unknown>> }>(
  `${apiBase}/favorites`,
  {
    headers: { cookie: Astro.request.headers.get("cookie") ?? "" },
  },
);
const data = result.data ?? { favorites: [] };
---

<Layout title="Favorites | Hidden Gems">
  <Card>
    <CardHeader><CardTitle>Your Favorites</CardTitle></CardHeader>
    <CardContent class="space-y-3">
      {!result.ok ? (
        <Alert variant="destructive">
          <AlertTitle>Unable to load favorites</AlertTitle>
          <AlertDescription>{result.error ?? "Login required."}</AlertDescription>
        </Alert>
      ) : data.favorites.length === 0 ? (
        <p class="text-sm text-muted-foreground">No favorites yet.</p>
      ) : (
        <div class="space-y-3">
          {data.favorites.map((favorite: any) => (
            <div class="rounded-md border p-3">
              <p class="font-medium">{favorite.listing.title}</p>
              <div class="mb-2 mt-1">
                <Badge variant="outline">{favorite.listing.locationText ?? "No location"}</Badge>
              </div>
              <Button variant="outline" size="sm" asChild>
                <a href={`/listings/${favorite.listing.id}`}>View listing</a>
              </Button>
            </div>
          ))}
        </div>
      )}
    </CardContent>
  </Card>
</Layout>
